@page
@model api_flms_service.Pages.Users.IndexModel
@{
    ViewData["Title"] = "User List";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}
<div class="container">
    <h4 class="text-center">User List</h4>
    <div class="text-right mb-3">
        <a href="/Users/Manage" class="btn btn-success">Add New User</a>
    </div>
    <table class="table table-bordered table-hover text-center" id="usersTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Mobile</th>
                <th>Address</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Users will be dynamically loaded here -->
        </tbody>
    </table>
</div>

<script>
    async function fetchUsers() {
        try {
            const response = await fetch('/api/v0/users');
            const users = await response.json();
            const tableBody = document.querySelector('#usersTable tbody');
            tableBody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.mobile}</td>
                    <td>${user.address}</td>
                    <td>
                        <a href="/Users/Manage?id=${user.id}" class="btn btn-primary">Edit</a>
                        <button class="btn btn-danger" onclick="deleteUser(${user.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        } catch (err) {
            console.error("Failed to fetch users:", err);
        }
    }

    async function deleteUser(id) {
        if (confirm("Are you sure you want to delete this user?")) {
            try {
                const response = await fetch(`/api/v0/users/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    fetchUsers();
                } else {
                    console.error("Failed to delete user:", await response.json());
                }
            } catch (err) {
                console.error("Error during user deletion:", err);
            }
        }
    }

    // Fetch users on page load
    fetchUsers();
</script>
